<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>내체표 아웃풋</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=Press+Start+2P&family=Source+Code+Pro:wght@700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div class="hud-left">
        <h1 id="header-title">내체표 아웃풋</h1>
        <div id="combo-counter" class="hidden"></div>
    </div>
    <div class="hud-center">
        <div id="lives-container" class="hidden">
            <span class="heart-icon">♥</span>
            <span class="heart-icon">♥</span>
            <span class="heart-icon">♥</span>
        </div>
        <div id="timer-container" class="kitsch-box hidden">
            <div id="time">10:00</div>
            <div id="bar"><div></div></div>
        </div>
    </div>
    <div class="hud-right">
      <button id="force-quit-btn" class="btn hidden">강제 종료</button>
      <button id="show-answers-btn" class="btn hidden">정답 보기</button>
      <button id="reset-btn" class="btn hidden">재시작</button>
    </div>
  </header>
  <main id="music-quiz-main" class="hidden">
    <div class="tabs">
      <div class="tab active" data-target="performance">연주</div>
      <div class="tab" data-target="listening">감상</div>
      <div class="tab" data-target="creation">창작</div>
      <div class="tab" data-target="elements">음악 요소</div>
    </div>
    <section id="performance" class="active">
      <h2>연주</h2>
      <div class="grade-container">
        <div>
          <div class="grade-title">3~4학년</div>
          <table>
            <tbody>
              <tr>
                <th>지식 · 이해</th>
                <td>
                  <input data-answer="생활 속의 음악" placeholder="정답">
                  <input data-answer="기초적인 음악 요소" placeholder="정답">
                  <input data-answer="자세와 주법" placeholder="정답">
                  <input data-answer="느낌, 여러 소리" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>과정 · 기능</th>
                <td>
                  <input data-answer="노래 부르거나 악기 연주하기" placeholder="정답">
                  <input data-answer="신체로 표현하고 놀이하기" placeholder="정답">
                  <input data-answer="발표하고 이야기하기" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>가치 · 태도</th>
                <td>
                  <input data-answer="연주를 즐기는 태도" placeholder="정답">
                  <input data-answer="연주에 대한 관심" placeholder="정답">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div>
          <div class="grade-title">5~6학년</div>
          <table>
            <tbody>
              <tr>
                <th>지식 · 이해</th>
                <td>
                  <input data-answer="간단한 악곡의 연주 형태" placeholder="정답">
                  <input data-answer="음악 요소" placeholder="정답">
                  <input data-answer="주법과 표현 기법" placeholder="정답">
                  <input data-answer="어울림, 여러 악기" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>과정 · 기능</th>
                <td>
                  <input data-answer="노래 부르거나 악기 연주하기" placeholder="정답">
                  <input data-answer="다양한 방법으로 표현하기" placeholder="정답">
                  <input data-answer="발표하고 돌아보기" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>가치 · 태도</th>
                <td>
                  <input data-answer="음악으로 함께하는 태도" placeholder="정답">
                  <input data-answer="연주 준비와 참여" placeholder="정답">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
    <section id="listening">
      <h2>감상</h2>
      <div class="grade-container">
        <div>
          <div class="grade-title">3~4학년</div>
          <table>
              <tbody>
              <tr>
                <th>지식 · 이해</th>
                <td>
                  <input data-answer="다양한 종류의 음악" placeholder="정답">
                  <input data-answer="지역의 음악 문화유산" placeholder="정답">
                  <input data-answer="기초적인 음악 요소" placeholder="정답">
                  <input data-answer="음악적 특징" placeholder="정답">
                  <input data-answer="느낌, 분위기, 쓰임" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>과정 · 기능</th>
                <td>
                  <input data-answer="반응하며 듣기" placeholder="정답">
                  <input data-answer="탐색하고 발견하기" placeholder="정답">
                  <input data-answer="묘사하거나 이야기하기" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>가치 · 태도</th>
                <td>
                  <input data-answer="소리와 음악을 즐기는 태도" placeholder="정답">
                  <input data-answer="음악에 대한 호기심" placeholder="정답">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div>
          <div class="grade-title">5~6학년</div>
          <table>
            <tbody>
              <tr>
                <th>지식 · 이해</th>
                <td>
                  <input data-answer="다양한 종류와 문화권의 음악" placeholder="정답">
                  <input data-answer="우리나라 음악 문화유산" placeholder="정답">
                  <input data-answer="음악 요소" placeholder="정답">
                  <input data-answer="음악적 특징, 음악의 간단한 구성" placeholder="정답">
                  <input data-answer="느낌, 배경, 활용" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>과정 · 기능</th>
                <td>
                  <input data-answer="감상하며 듣기" placeholder="정답">
                  <input data-answer="인식하고 구별하기" placeholder="정답">
                  <input data-answer="설명하기" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>가치 · 태도</th>
                <td>
                  <input data-answer="음악의 아름다움에 대한 인식" placeholder="정답">
                  <input data-answer="음악에 대한 공감" placeholder="정답">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
    <section id="creation">
      <h2>창작</h2>
      <div class="grade-container">
        <div>
          <div class="grade-title">3~4학년</div>
          <table>
            <tbody>
              <tr>
                <th>지식 · 이해</th>
                <td>
                  <input data-answer="소리와 음악" placeholder="정답">
                  <input data-answer="기초적인 음악 요소" placeholder="정답">
                  <input data-answer="간단한 악보" placeholder="정답">
                  <input data-answer="느낌, 상상" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>과정 · 기능</th>
                <td>
                  <input data-answer="즉흥적으로 표현하기" placeholder="정답">
                  <input data-answer="부분적으로 바꾸기" placeholder="정답">
                  <input data-answer="모방하여 나타내기" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>가치 · 태도</th>
                <td>
                  <input data-answer="음악에 대한 흥미" placeholder="정답">
                  <input data-answer="음악의 새로움을 즐기는 태도" placeholder="정답">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div>
          <div class="grade-title">5~6학년</div>
          <table>
            <tbody>
              <tr>
                <th>지식 · 이해</th>
                <td>
                  <input data-answer="간단한 음악" placeholder="정답">
                  <input data-answer="음악 요소" placeholder="정답">
                  <input data-answer="기초적인 기보, 음악 매체" placeholder="정답">
                  <input data-answer="느낌, 아이디어" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>과정 · 기능</th>
                <td>
                  <input data-answer="떠올리며 표현하기" placeholder="정답">
                  <input data-answer="간단한 조건에 따라 바꾸기" placeholder="정답">
                  <input data-answer="활용하여 만들기" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>가치 · 태도</th>
                <td>
                  <input data-answer="음악에 대한 자신감" placeholder="정답">
                  <input data-answer="음악에 대한 열린 태도" placeholder="정답">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
    <section id="elements">
      <h2>음악 요소</h2>
      <div class="grade-container">
        <div>
          <div class="grade-title">3~4학년</div>
          <table>
            <tbody>
              <tr>
                <th>리듬</th>
                <td>
                  <input data-answer="박, 박자" placeholder="정답">
                  <input data-answer="장단, 장단의 세" placeholder="정답">
                  <input data-answer="음의 길고 짧음" placeholder="정답">
                  <input data-answer="간단한 리듬꼴" placeholder="정답">
                  <input data-answer="장단꼴" placeholder="정답">
                  <input data-answer="말붙임새" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>가락</th>
                <td>
                  <input data-answer="음의 높고 낮음" placeholder="정답">
                  <input data-answer="차례가기와 뛰어가기" placeholder="정답">
                  <input data-answer="시김새" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>화성</th>
                <td><input data-answer="소리의 어울림" placeholder="정답"></td>
              </tr>
              <tr>
                <th>형식</th>
                <td><input data-answer="형식(메기고 받는 형식, ab 등)" placeholder="정답"></td>
              </tr>
              <tr>
                <th>셈여림</th>
                <td><input data-answer="셈여림" placeholder="정답"></td>
              </tr>
              <tr>
                <th>빠르기</th>
                <td><input data-answer="빠르기/한배" placeholder="정답"></td>
              </tr>
              <tr>
                <th>음색</th>
                <td><input data-answer="목소리, 물체 소리, 타악기의 음색" placeholder="정답"></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div>
          <div class="grade-title">5~6학년</div>
          <table>
            <tbody>
              <tr>
                <th>리듬</th>
                <td>
                  <input data-answer="박, 박자" placeholder="정답">
                  <input data-answer="장단, 장단의 세" placeholder="정답">
                  <input data-answer="여러 가지 리듬꼴" placeholder="정답">
                  <input data-answer="장단꼴" placeholder="정답">
                  <input data-answer="말붙임새" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>가락</th>
                <td>
                  <input data-answer="음이름, 계이름, 율명" placeholder="정답">
                  <input data-answer="장음계, 단음계" placeholder="정답">
                  <input data-answer="여러 지역의 토리" placeholder="정답">
                  <input data-answer="시김새" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>화성</th>
                <td>
                  <input data-answer="주요 3화음" placeholder="정답">
                  <input data-answer="다양한 소리의 어울림" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>형식</th>
                <td><input data-answer="형식(긴자진 형식, 시조 형식, aba, AB 등)" placeholder="정답"></td>
              </tr>
              <tr>
                <th>셈여림</th>
                <td><input data-answer="셈여림의 변화" placeholder="정답"></td>
              </tr>
              <tr>
                <th>빠르기</th>
                <td><input data-answer="빠르기의 변화/한배의 변화" placeholder="정답"></td>
              </tr>
              <tr>
                <th>음색</th>
                <td><input data-answer="관악기, 현악기의 음색" placeholder="정답"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
  
  <main id="art-quiz-main" class="hidden">
    <div class="tabs">
      <div class="tab active" data-target="aesthetic-experience">미적체험</div>
      <div class="tab" data-target="expression">표현</div>
      <div class="tab" data-target="appreciation">감상</div>
    </div>
    <section id="aesthetic-experience" class="active">
      <h2>미적체험</h2>
      <div class="grade-container">
        <div>
          <div class="grade-title">3~4학년</div>
          <table>
            <tbody>
              <tr>
                <th>지식 · 이해</th>
                <td>
                  <input data-answer="자신의 감각" placeholder="정답">
                  <input data-answer="대상의 특징" placeholder="정답">
                  <input data-answer="생활 속 미술" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>과정 · 기능</th>
                <td>
                  <input data-answer="감각을 활용하여 탐색하기" placeholder="정답">
                  <input data-answer="대상에 반응하여 느낌과 생각을 나타내기" placeholder="정답">
                  <input data-answer="미술의 특징과 역할을 발견하기" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>가치 · 태도</th>
                <td>
                  <input data-answer="미적 탐색에 대한 호기심" placeholder="정답">
                  <input data-answer="미술의 역할에 관한 관심" placeholder="정답">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div>
          <div class="grade-title">5~6학년</div>
          <table>
            <tbody>
              <tr>
                <th>지식 · 이해</th>
                <td>
                  <input data-answer="감각과 매체의 역할" placeholder="정답">
                  <input data-answer="자신과 환경의 관계" placeholder="정답">
                  <input data-answer="이미지와 의미" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>과정 · 기능</th>
                <td>
                  <input data-answer="감각과 매체를 활용하여 탐색하기" placeholder="정답">
                  <input data-answer="대상과 상호 작용하며 의미 발견하기" placeholder="정답">
                  <input data-answer="이미지를 해석하고 활용하기" placeholder="정답">
                </td>
              </tr>
              <tr>
                <th>가치 · 태도</th>
                <td>
                  <input data-answer="주변 환경에 대한 민감성" placeholder="정답">
                  <input data-answer="비판적으로 이해하는 태도" placeholder="정답">
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
    <section id="expression">
        <h2>표현</h2>
        <div class="grade-container">
            <div>
                <div class="grade-title">3~4학년</div>
                <table>
                    <tbody>
                        <tr><th>지식 · 이해</th><td><input data-answer="표현 주제" placeholder="정답"><input data-answer="기본적인 표현 재료와 용구" placeholder="정답"><input data-answer="조형 요소의 특징" placeholder="정답"></td></tr>
                        <tr><th>과정 · 기능</th><td><input data-answer="관찰과 상상으로 아이디어를 떠올리기" placeholder="정답"><input data-answer="표현 방법을 익히기" placeholder="정답"><input data-answer="의도를 가지고 작품을 제작하기" placeholder="정답"><input data-answer="타 교과와 관련짓기" placeholder="정답"></td></tr>
                        <tr><th>가치 · 태도</th><td><input data-answer="표현에 대한 흥미" placeholder="정답"><input data-answer="자기 작품을 소중히 여기는 태도" placeholder="정답"></td></tr>
                    </tbody>
                </table>
            </div>
            <div>
                <div class="grade-title">5~6학년</div>
                <table>
                    <tbody>
                        <tr><th>지식 · 이해</th><td><input data-answer="표현 주제와 발상" placeholder="정답"><input data-answer="표현 재료와 용구, 디지털 매체" placeholder="정답"><input data-answer="조형 요소와 원리의 관계" placeholder="정답"></td></tr>
                        <tr><th>과정 · 기능</th><td><input data-answer="다양한 방법으로 아이디어를 연결하기" placeholder="정답"><input data-answer="표현 방법을 탐색하여 활용하기" placeholder="정답"><input data-answer="과정을 돌아보며 작품을 발전시키기" placeholder="정답"><input data-answer="타 교과와 융합하기" placeholder="정답"></td></tr>
                        <tr><th>가치 · 태도</th><td><input data-answer="주제 표현의 의지" placeholder="정답"><input data-answer="자유롭게 시도하는 태도" placeholder="정답"></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
    <section id="appreciation">
        <h2>감상</h2>
        <div class="grade-container">
            <div>
                <div class="grade-title">3~4학년</div>
                <table>
                    <tbody>
                        <tr><th>지식 · 이해</th><td><input data-answer="미술 작품과 미술가" placeholder="정답"><input data-answer="미술 작품의 특징" placeholder="정답"><input data-answer="미술 전시" placeholder="정답"></td></tr>
                        <tr><th>과정 · 기능</th><td><input data-answer="자세히 보고 질문하기" placeholder="정답"><input data-answer="미술 작품에 관한 느낌과 생각을 설명하기" placeholder="정답"><input data-answer="미술 전시 및 행사에 참여하기" placeholder="정답"></td></tr>
                        <tr><th>가치 · 태도</th><td><input data-answer="자신의 감상 관점 존중" placeholder="정답"><input data-answer="미술 문화에 관한 관심" placeholder="정답"></td></tr>
                    </tbody>
                </table>
            </div>
            <div>
                <div class="grade-title">5~6학년</div>
                <table>
                    <tbody>
                        <tr><th>지식 · 이해</th><td><input data-answer="미술 작품의 배경" placeholder="정답"><input data-answer="미술 작품의 내용과 형식" placeholder="정답"><input data-answer="공동체의 미술 문화" placeholder="정답"></td></tr>
                        <tr><th>과정 · 기능</th><td><input data-answer="작품과 배경을 연결하기" placeholder="정답"><input data-answer="다양한 방법으로 분석하기" placeholder="정답"><input data-answer="미술 문화 활동을 경험하고 공유하기" placeholder="정답"></td></tr>
                        <tr><th>가치 · 태도</th><td><input data-answer="서로 다른 관점의 존중" placeholder="정답"><input data-answer="공동체 문화에 참여" placeholder="정답"></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
  </main>
  
  <main id="korean-quiz-main" class="hidden">
    <div class="tabs">
      <div class="tab active" data-target="listening-speaking">듣기·말하기</div>
      <div class="tab" data-target="reading">읽기</div>
      <div class="tab" data-target="writing">쓰기</div>
      <div class="tab" data-target="grammar">문법</div>
      <div class="tab" data-target="literature">문학</div>
      <div class="tab" data-target="media">매체</div>
    </div>
    <section id="listening-speaking" class="active">
        <h2>듣기·말하기</h2>
        <div class="grade-container">
            <div>
                <table>
                    <tbody>
                        <tr>
                            <th>지식 · 이해</th>
                            <td>
                                <input data-answer="듣기·말하기 맥락" placeholder="정답">
                                <input data-answer="담화 유형" placeholder="정답">
                            </td>
                        </tr>
                        <tr>
                            <th>과정 · 기능</th>
                            <td>
                                <input data-answer="내용 확인·추론·평가" placeholder="정답">
                                <input data-answer="내용 생성·조직·표현과 전달" placeholder="정답">
                                <input data-answer="상호 작용" placeholder="정답">
                                <input data-answer="점검과 조정" placeholder="정답">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
    <section id="reading">
        <h2>읽기</h2>
        <div class="grade-container">
            <div>
                <table>
                    <tbody>
                        <tr>
                            <th>지식 · 이해</th>
                            <td>
                                <input data-answer="읽기 맥락" placeholder="정답">
                                <input data-answer="글의 유형" placeholder="정답">
                            </td>
                        </tr>
                        <tr>
                            <th>과정 · 기능</th>
                            <td>
                                <input data-answer="읽기의 기초" placeholder="정답">
                                <input data-answer="내용 확인과 추론" placeholder="정답">
                                <input data-answer="평가와 창의" placeholder="정답">
                                <input data-answer="점검과 조정" placeholder="정답">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
    <section id="writing">
        <h2>쓰기</h2>
        <div class="grade-container">
            <div>
                <table>
                    <tbody>
                        <tr>
                            <th>지식 · 이해</th>
                            <td>
                                <input data-answer="쓰기 맥락" placeholder="정답">
                                <input data-answer="글의 유형" placeholder="정답">
                            </td>
                        </tr>
                        <tr>
                            <th>과정 · 기능</th>
                            <td>
                                <input data-answer="쓰기의 기초" placeholder="정답">
                                <input data-answer="계획하기" placeholder="정답">
                                <input data-answer="내용 생성하기" placeholder="정답">
                                <input data-answer="내용 조직하기" placeholder="정답">
                                <input data-answer="표현하기" placeholder="정답">
                                <input data-answer="공유하기" placeholder="정답">
                                <input data-answer="점검과 조정" placeholder="정답">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
    <section id="grammar">
        <h2>문법</h2>
        <div class="grade-container">
            <div>
                <table>
                    <tbody>
                        <tr>
                            <th>지식 · 이해</th>
                            <td>
                                <input data-answer="언어의 본질과 맥락" placeholder="정답">
                                <input data-answer="언어 단위" placeholder="정답">
                                <input data-answer="한글의 기초와 국어 규범" placeholder="정답">
                            </td>
                        </tr>
                        <tr>
                            <th>과정 · 기능</th>
                            <td>
                                <input data-answer="국어의 분석과 활용" placeholder="정답">
                                <input data-answer="국어 실천의 성찰과 비판" placeholder="정답">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
    <section id="literature">
        <h2>문학</h2>
        <div class="grade-container">
            <div>
                <table>
                    <tbody>
                        <tr>
                            <th>지식 · 이해</th>
                            <td>
                                <input data-answer="갈래" placeholder="정답">
                                <input data-answer="맥락" placeholder="정답">
                            </td>
                        </tr>
                        <tr>
                            <th>과정 · 기능</th>
                            <td>
                                <input data-answer="작품 읽기와 이해" placeholder="정답">
                                <input data-answer="해석과 감상" placeholder="정답">
                                <input data-answer="비평" placeholder="정답">
                                <input data-answer="창작" placeholder="정답">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
    <section id="media">
        <h2>매체</h2>
        <div class="grade-container">
            <div>
                <table>
                    <tbody>
                        <tr>
                            <th>지식 · 이해</th>
                            <td>
                                <input data-answer="매체 소통 맥락" placeholder="정답">
                                <input data-answer="매체 자료 유형" placeholder="정답">
                            </td>
                        </tr>
                        <tr>
                            <th>과정 · 기능</th>
                            <td>
                                <input data-answer="접근과 선택" placeholder="정답">
                                <input data-answer="해석과 평가" placeholder="정답">
                                <input data-answer="제작과 공유" placeholder="정답">
                                <input data-answer="점검과 조정" placeholder="정답">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
  </main>

  <div id="character-assistant" class="idle">
      <div class="mushroom">
          <div class="devil-horns">
              <div class="horn left"></div>
              <div class="horn right"></div>
          </div>
          <div class="mushroom-cap">
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="spore-container"></div>
          </div>
          <div class="mushroom-stem">
              <div class="character-eye left"></div>
              <div class="character-eye right"></div>
          </div>
          <div class="fire-effect">
              <div class="flame"></div><div class="flame"></div><div class="flame"></div><div class="flame"></div><div class="flame"></div>
          </div>
      </div>
  </div>

  <div id="stage-clear-modal" class="modal-overlay">
    <div class="modal-content">
      <h2>Stage Clear!</h2>
      <p>축하합니다! 이 영역을 마스터했습니다!</p>
      <button id="close-modal-btn" class="btn">닫기</button>
    </div>
  </div>
  
  <div id="progress-modal" class="modal-overlay">
      <div class="modal-content">
          <div id="result-character-container">
              <div id="modal-character-placeholder"></div>
              <div class="speech-bubble hidden">
                  <p id="result-dialogue"></p>
              </div>
          </div>
          <h2 id="result-title">게임 결과</h2>
          <p>맞춘 개수: <span id="correct-count">0</span> / <span id="total-count">0</span></p>
          <div class="progress-bar-container">
              <div id="progress-bar-fill"></div>
          </div>
          <p id="progress-text">0%</p>
          <button id="close-progress-modal-btn" class="btn">확인</button>
      </div>
  </div>
  
  <div id="guide-modal" class="modal-overlay">
      <div class="modal-content">
          <h3>HOW TO PLAY</h3>
          <div class="guide-steps">
              <div class="guide-step">
                  <div class="guide-label">STEP 1</div>
                  <div class="guide-text"><strong>설정:</strong> 학습할 과목, 모드, 시간을 선택하세요.</div>
              </div>
              <div class="guide-step">
                  <div class="guide-label">STEP 2</div>
                  <div class="guide-text"><strong>시작:</strong> '시작' 버튼을 눌러 게임을 시작!</div>
              </div>
              <div class="guide-step">
                  <div class="guide-label">STEP 3</div>
                  <div class="guide-text"><strong>채점:</strong> 빈칸에 정답을 입력하면 즉시 채점됩니다.</div>
              </div>
              <div class="guide-step">
                  <div class="guide-label">STEP 4</div>
                  <div class="guide-text"><strong>복습:</strong> 게임 종료 후, '정답 보기'로 복습하세요.</div>
              </div>
          </div>
          <p class="tip">※ 채점 시 띄어쓰기와 ⋅ 기호는 무시됩니다.</p>
          <button id="close-guide-btn" class="btn">OK!</button>
      </div>
  </div>

  <div id="start-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>과목 선택</h2>
            <div class="subject-selector">
                <button class="btn subject-btn selected" data-subject="music">음악</button>
                <button class="btn subject-btn" data-subject="art">미술</button>
                <button class="btn subject-btn" data-subject="korean">국어</button>
                <button id="random-subject-btn" class="btn" data-subject="random">랜덤</button>
            </div>
            <h2>게임 모드</h2>
            <div class="mode-selector">
                <button class="btn mode-btn selected" data-mode="normal">기본 모드</button>
                <button class="btn mode-btn" data-mode="hard-core">하드 코어</button>
            </div>
            <div id="time-setter-wrapper">
                <h2>제한 시간 선택</h2>
                <div class="time-setter">
                    <button id="decrease-time" class="btn time-control-btn">-</button>
                    <div id="time-setting-display">10:00</div>
                    <button id="increase-time" class="btn time-control-btn">+</button>
                </div>
            </div>
            <div id="hard-core-description" class="notice-text hidden">
                <p>3번 틀리면 게임이 즉시 종료됩니다.<br>(제한시간 30초, 정답 시 +3초)</p>
            </div>
            <button id="start-game-btn" class="btn">시작</button>
        </div>
    </div>


  <script src="app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- AudioContext for Autoplay Policy ---
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function unlockAudio() {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            document.body.removeEventListener('click', unlockAudio);
            document.body.removeEventListener('touchend', unlockAudio);
        }
        document.body.addEventListener('click', unlockAudio);
        document.body.addEventListener('touchend', unlockAudio);


        // --- CONSTANTS ---
        const CONSTANTS = {
            SUBJECTS: {
                MUSIC: 'music',
                ART: 'art',
                KOREAN: 'korean',
                RANDOM: 'random'
            },
            MODES: {
                NORMAL: 'normal',
                HARD_CORE: 'hard-core'
            },
            CSS_CLASSES: {
                HIDDEN: 'hidden',
                CORRECT: 'correct',
                INCORRECT: 'incorrect',
                RETRYING: 'retrying',
                REVEALED: 'revealed',
                SELECTED: 'selected',
                IS_SELECTING: 'is-selecting',
                ACTIVE: 'active',
                LOST: 'lost',
                COMBO_POP: 'combo-pop'
            },
            DEFAULT_DURATION: 600,
            HARD_CORE_DURATION: 30, 
            HARD_CORE_LIVES: 3,
            HARD_CORE_TIME_BONUS: 3,
            RANDOM_ANIMATION_DURATION: 2000,
            RANDOM_ANIMATION_INTERVAL: 100
        };

        // --- GAME STATE ---
        const gameState = {
            duration: CONSTANTS.DEFAULT_DURATION,
            total: CONSTANTS.DEFAULT_DURATION,
            timerId: null,
            combo: 0,
            lives: CONSTANTS.HARD_CORE_LIVES,
            selectedSubject: CONSTANTS.SUBJECTS.MUSIC,
            gameMode: CONSTANTS.MODES.NORMAL,
            isRandomizing: false,
            typingInterval: null
        };

        // --- DOM Elements ---
        const timeEl = document.getElementById('time');
        const barEl = document.querySelector('#bar > div');
        const comboCounter = document.getElementById('combo-counter');
        const showAnswersBtn = document.getElementById('show-answers-btn');
        const startGameBtn = document.getElementById('start-game-btn');
        const forceQuitBtn = document.getElementById('force-quit-btn');
        const resetBtn = document.getElementById('reset-btn');
        const character = document.getElementById('character-assistant');
        const headerTitle = document.getElementById('header-title');
        const livesContainer = document.getElementById('lives-container');
        const stageClearModal = document.getElementById('stage-clear-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const progressModal = document.getElementById('progress-modal');
        const closeProgressModalBtn = document.getElementById('close-progress-modal-btn');
        const startModal = document.getElementById('start-modal');
        const guideModal = document.getElementById('guide-modal');
        const closeGuideBtn = document.getElementById('close-guide-btn');
        const timeSettingDisplay = document.getElementById('time-setting-display');
        const decreaseTimeBtn = document.getElementById('decrease-time');
        const increaseTimeBtn = document.getElementById('increase-time');
        const timeSetterWrapper = document.getElementById('time-setter-wrapper');
        const subjectSelector = document.querySelector('.subject-selector');
        const quizContainers = document.querySelectorAll('main[id$="-quiz-main"]');
        const modalCharacterPlaceholder = document.getElementById('modal-character-placeholder');
        const speechBubble = document.querySelector('.speech-bubble');
        const resultDialogue = document.getElementById('result-dialogue');
        const resultTitle = document.getElementById('result-title');
        
        // --- Audio ---
        const successAudio = new Audio('./success.mp3');
        successAudio.preload = 'auto';
        const timeupAudio = new Audio('./timeup.mp3');
        timeupAudio.preload = 'auto';
        const startAudio = new Audio('./start.mp3');
        startAudio.preload = 'auto';
        const failAudio = new Audio('./fail.mp3');
        failAudio.preload = 'auto';
        const clearAudio = new Audio('./clear.mp3');
        clearAudio.preload = 'auto';
        const randomAudio = new Audio('./random.mp3');
        randomAudio.preload = 'auto';
        const clickAudio = new Audio('./click.mp3');
        clickAudio.preload = 'auto';
        
        // --- UTILITY FUNCTIONS ---
        const fmt = n => String(n).padStart(2, '0');
        const formatTime = s => `${fmt(Math.floor(s / 60))}:${fmt(s % 60)}`;

        function playSound(audioElement) {
            if (audioContext.state === 'running' && audioElement && typeof audioElement.play === 'function') {
                audioElement.currentTime = 0;
                audioElement.play().catch(err => {
                    console.error(`Audio playback failed for ${audioElement.src}:`, err);
                });
            } else if (audioElement && typeof audioElement.play !== 'function') {
                 console.error("Provided element is not a valid audio element.");
            }
        }

        function typewriter(element, text) {
            if (gameState.typingInterval) {
                clearInterval(gameState.typingInterval);
            }
            element.textContent = '';
            let i = 0;
            gameState.typingInterval = setInterval(() => {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                } else {
                    clearInterval(gameState.typingInterval);
                    gameState.typingInterval = null;
                }
            }, 50);
        }

        // --- UI UPDATE FUNCTIONS ---
        function updateTimeSettingDisplay() {
            timeSettingDisplay.textContent = formatTime(gameState.duration);
        }

        function updateLivesUI() {
            const heartIcons = livesContainer.querySelectorAll('.heart-icon');
            heartIcons.forEach((heart, index) => {
                heart.classList.toggle(CONSTANTS.CSS_CLASSES.LOST, index >= gameState.lives);
            });
        }

        function setCharacterState(state, duration = 1500) {
            character.className = '';
            character.classList.add(state);
            if (gameState.gameMode === CONSTANTS.MODES.HARD_CORE) {
                character.classList.add('devil-mode');
            }
            
            updateMushroomGrowth();

            if (state === 'happy' || state === 'sad') {
                setTimeout(() => {
                    const baseState = (gameState.total > 0 && gameState.total < 30 && gameState.gameMode !== CONSTANTS.MODES.HARD_CORE) ? 'worried' : 'idle';
                    character.className = '';
                    character.classList.add(baseState);
                    if (gameState.gameMode === CONSTANTS.MODES.HARD_CORE) {
                        character.classList.add('devil-mode');
                    }
                    updateMushroomGrowth();
                }, duration);
            }
        }
        
        function updateMushroomGrowth() {
            character.classList.remove('combo-level-1', 'combo-level-2', 'combo-level-3');
            if (gameState.gameMode === CONSTANTS.MODES.HARD_CORE) return;
            
            if (gameState.combo >= 10) character.classList.add('combo-level-3');
            else if (gameState.combo >= 5) character.classList.add('combo-level-2');
            else if (gameState.combo >= 2) character.classList.add('combo-level-1');
        }

        function showProgress() {
            const allInputs = document.querySelectorAll(`#${gameState.selectedSubject}-quiz-main input[data-answer]`);
            const correctCount = document.querySelectorAll(`#${gameState.selectedSubject}-quiz-main input.${CONSTANTS.CSS_CLASSES.CORRECT}`).length;
            const totalCount = allInputs.length;
            const percentage = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;

            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('total-count').textContent = totalCount;
            document.getElementById('progress-text').textContent = `${percentage}%`;
            
            const progressBarFill = document.getElementById('progress-bar-fill');
            
            let feedback;
            if (percentage === 100) {
                feedback = { title: "신의 경지", dialogue: "완벽해! 당신은 이 게임의 신이야!", animation: "cheer", effect: "perfect" };
            } else if (percentage >= 90) {
                feedback = { title: "내체표 마스터", dialogue: "대단한 실력인데? 거의 마스터 수준이야!", animation: "happy", effect: "excellent" };
            } else if (percentage >= 70) {
                feedback = { title: "내체표 고수", dialogue: "꽤 하는걸? 이 감각, 잊지 말라구!", animation: "idle", effect: "great" };
            } else if (percentage >= 50) {
                feedback = { title: "내체표 중수", dialogue: "절반은 넘었네! 다음엔 더 잘할 수 있겠어.", animation: "idle", effect: "good" };
            } else if (percentage >= 20) {
                feedback = { title: "내체표 하수", dialogue: "으... 너무 어려웠어. 다시 해볼까?", animation: "sad", effect: "notbad" };
            } else {
                feedback = { title: "내체표 입문자", dialogue: "털썩... (아무 말도 하지 못했다)", animation: "sad", effect: "tryagain" };
            }

            resultTitle.textContent = feedback.title;
            
            modalCharacterPlaceholder.innerHTML = '';
            modalCharacterPlaceholder.appendChild(character.cloneNode(true));
            
            setTimeout(() => {
                const modalChar = modalCharacterPlaceholder.querySelector('#character-assistant');
                modalChar.className = '';
                modalChar.classList.add(feedback.animation);
                 if (gameState.gameMode === CONSTANTS.MODES.HARD_CORE) {
                    modalChar.classList.add('devil-mode');
                }
            }, 100);

            speechBubble.classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
            typewriter(resultDialogue, feedback.dialogue);
            
            progressModal.classList.add(CONSTANTS.CSS_CLASSES.ACTIVE);
            setTimeout(() => { progressBarFill.style.width = `${percentage}%`; }, 100);
        }

        // --- GAME LOGIC FUNCTIONS ---
        function handleGameOver() {
            clearInterval(gameState.timerId);
            gameState.timerId = null;
            document.querySelectorAll(`#${gameState.selectedSubject}-quiz-main input[data-answer]`).forEach(i => i.disabled = true);
            playSound(timeupAudio);
            
            gameState.combo = 0;
            updateMushroomGrowth();
            headerTitle.classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
            comboCounter.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);
            
            forceQuitBtn.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);
            setCharacterState('sad');
            showProgress();
        }

        function tick() {
            if (gameState.total <= 0) {
                handleGameOver();
                return;
            }
            gameState.total--;
            timeEl.textContent = formatTime(gameState.total);
            
            let currentDuration = (gameState.gameMode === CONSTANTS.MODES.HARD_CORE) ? CONSTANTS.HARD_CORE_DURATION : gameState.duration;
            barEl.style.width = `${(gameState.total / currentDuration) * 100}%`;

            if (gameState.total < 30 && !character.classList.contains('happy') && !character.classList.contains('sad') && gameState.gameMode !== CONSTANTS.MODES.HARD_CORE) {
                setCharacterState('worried', 1000);
            }
        }

        function resetGame(showStartModal = true) {
            clearInterval(gameState.timerId);
            gameState.timerId = null;
            
            quizContainers.forEach(main => main.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN));
            document.querySelectorAll('input[data-answer]').forEach(i => {
                i.disabled = true;
                i.value = '';
                i.className = '';
            });
            
            gameState.combo = 0;
            updateMushroomGrowth();
            headerTitle.textContent = '내체표 아웃풋';
            headerTitle.classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
            comboCounter.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);
            showAnswersBtn.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);
            showAnswersBtn.disabled = false;
            resetBtn.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);
            forceQuitBtn.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);
            document.getElementById('timer-container').classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);
            livesContainer.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);
            
            if (showStartModal) {
                startModal.classList.add(CONSTANTS.CSS_CLASSES.ACTIVE);
            }
            
            setCharacterState('idle');
        }

        function startGame() {
            playSound(startAudio);
            startModal.classList.remove(CONSTANTS.CSS_CLASSES.ACTIVE);
            
            const subjectMap = { [CONSTANTS.SUBJECTS.MUSIC]: '음악', [CONSTANTS.SUBJECTS.ART]: '미술', [CONSTANTS.SUBJECTS.KOREAN]: '국어' };
            headerTitle.textContent = subjectMap[gameState.selectedSubject] || '퀴즈';
            document.getElementById(`${gameState.selectedSubject}-quiz-main`).classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
            
            document.querySelectorAll(`#${gameState.selectedSubject}-quiz-main input[data-answer]`).forEach(i => i.disabled = false);
            
            forceQuitBtn.classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
            
            if (gameState.gameMode === CONSTANTS.MODES.HARD_CORE) {
                gameState.duration = CONSTANTS.HARD_CORE_DURATION;
                gameState.lives = CONSTANTS.HARD_CORE_LIVES;
                updateLivesUI();
                livesContainer.classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
                document.getElementById('timer-container').classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
                document.getElementById('bar').style.display = 'none';
            } else {
                const timeParts = timeSettingDisplay.textContent.split(':');
                gameState.duration = parseInt(timeParts[0], 10) * 60 + parseInt(timeParts[1], 10);
                livesContainer.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);
                document.getElementById('timer-container').classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
                document.getElementById('bar').style.display = 'block';
            }
            gameState.total = gameState.duration;
            timeEl.textContent = formatTime(gameState.total);
            barEl.style.width = '100%';
            if (gameState.timerId === null) {
                gameState.timerId = setInterval(tick, 1000);
            }
            setCharacterState('idle');
            if (gameState.gameMode === CONSTANTS.MODES.HARD_CORE) {
                character.classList.add('devil-mode');
            }
        }

        function checkStageClear(sectionElement) {
            const inputsInSection = sectionElement.querySelectorAll('input[data-answer]');
            return inputsInSection.length > 0 && [...inputsInSection].every(input => input.classList.contains(CONSTANTS.CSS_CLASSES.CORRECT));
        }

        function showStageClear() {
            playSound(clearAudio);
            stageClearModal.classList.add(CONSTANTS.CSS_CLASSES.ACTIVE);
            setCharacterState('cheer', 5000);
            
            const duration = 2 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 201 };
            function randomInRange(min, max) { return Math.random() * (max - min) + min; }
            const interval = setInterval(() => {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                const particleCount = 50 * (timeLeft / duration);
                confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
                confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
            }, 250);
        }

        function handleInputChange(e) {
            const input = e.target;
            if (!input.matches('input[data-answer]') || input.disabled) return;

            const userAnswer = input.value.trim().replace(/[\s⋅·]+/g, '').toLowerCase();
            const correctAnswer = input.dataset.answer.trim().replace(/[\s⋅·]+/g, '').toLowerCase();
            
            if (userAnswer === correctAnswer) {
                playSound(successAudio);
                input.classList.remove(CONSTANTS.CSS_CLASSES.INCORRECT, CONSTANTS.CSS_CLASSES.RETRYING);
                input.classList.add(CONSTANTS.CSS_CLASSES.CORRECT);
                input.value = input.dataset.answer;
                input.disabled = true;

                gameState.combo++;
                setCharacterState('happy');
                updateMushroomGrowth();

                if (gameState.gameMode === CONSTANTS.MODES.HARD_CORE) {
                    gameState.total += CONSTANTS.HARD_CORE_TIME_BONUS;
                    timeEl.textContent = formatTime(gameState.total);
                }
                
                if (gameState.combo > 1) {
                    headerTitle.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);
                    comboCounter.textContent = `COMBO x${gameState.combo}`;
                    comboCounter.classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
                    comboCounter.classList.remove(CONSTANTS.CSS_CLASSES.COMBO_POP);
                    void comboCounter.offsetWidth;
                    comboCounter.classList.add(CONSTANTS.CSS_CLASSES.COMBO_POP);
                }
                
                if (checkStageClear(input.closest('section'))) {
                    setTimeout(showStageClear, 300);
                }
            } else {
                gameState.combo = 0;
                updateMushroomGrowth();
                headerTitle.classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
                comboCounter.classList.add(CONSTANTS.CSS_CLASSES.HIDDEN);

                if (input.classList.contains(CONSTANTS.CSS_CLASSES.RETRYING)) {
                    playSound(failAudio);
                    setCharacterState('sad');

                    input.classList.remove(CONSTANTS.CSS_CLASSES.RETRYING);
                    input.classList.add(CONSTANTS.CSS_CLASSES.INCORRECT);
                    
                    input.value = input.dataset.answer;
                    input.disabled = true;
                    
                    if (gameState.gameMode === CONSTANTS.MODES.HARD_CORE) {
                        gameState.lives--;
                        updateLivesUI();
                        if (gameState.lives <= 0) {
                            handleGameOver();
                        }
                    }
                } else {
                    playSound(failAudio);
                    setCharacterState('sad');

                    input.classList.add(CONSTANTS.CSS_CLASSES.RETRYING);
                    input.value = '';
                }
            }
        }

        // --- EVENT LISTENERS ---
        subjectSelector.addEventListener('click', e => {
            if (!e.target.matches('.btn') || gameState.isRandomizing) return;

            const clickedBtn = e.target;
            const subject = clickedBtn.dataset.subject;
            
            if (subject !== CONSTANTS.SUBJECTS.RANDOM) {
                 playSound(clickAudio);
            }

            if (subject === CONSTANTS.SUBJECTS.RANDOM) {
                gameState.isRandomizing = true;
                const subjectBtns = Array.from(document.querySelectorAll('.subject-btn:not([data-subject="random"])'));
                const allSelectorBtns = document.querySelectorAll('.subject-selector .btn');
                
                allSelectorBtns.forEach(b => b.disabled = true);
                subjectBtns.forEach(b => b.classList.remove(CONSTANTS.CSS_CLASSES.SELECTED));

                randomAudio.loop = true;
                playSound(randomAudio);

                let shuffleCount = 0;
                const maxShuffles = CONSTANTS.RANDOM_ANIMATION_DURATION / CONSTANTS.RANDOM_ANIMATION_INTERVAL;

                const randomInterval = setInterval(() => {
                    shuffleCount++;
                    subjectBtns.forEach(b => b.classList.remove(CONSTANTS.CSS_CLASSES.IS_SELECTING));

                    if (shuffleCount >= maxShuffles) {
                        clearInterval(randomInterval);
                        randomAudio.pause();
                        
                        const randomIndex = Math.floor(Math.random() * subjectBtns.length);
                        const chosenBtn = subjectBtns[randomIndex];
                        
                        chosenBtn.classList.add(CONSTANTS.CSS_CLASSES.SELECTED);
                        gameState.selectedSubject = chosenBtn.dataset.subject;
                        
                        allSelectorBtns.forEach(b => b.disabled = false);
                        gameState.isRandomizing = false;
                        return;
                    }
                    
                    const currentIndex = shuffleCount % subjectBtns.length;
                    subjectBtns[currentIndex].classList.add(CONSTANTS.CSS_CLASSES.IS_SELECTING);
                }, CONSTANTS.RANDOM_ANIMATION_INTERVAL);
            } else {
                document.querySelectorAll('.subject-btn').forEach(b => b.classList.remove(CONSTANTS.CSS_CLASSES.SELECTED));
                clickedBtn.classList.add(CONSTANTS.CSS_CLASSES.SELECTED);
                gameState.selectedSubject = subject;
            }
        });

        document.querySelector('.mode-selector').addEventListener('click', e => {
            if (!e.target.matches('.btn')) return;
            playSound(clickAudio);
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove(CONSTANTS.CSS_CLASSES.SELECTED));
            e.target.classList.add(CONSTANTS.CSS_CLASSES.SELECTED);
            gameState.gameMode = e.target.dataset.mode;
            timeSetterWrapper.style.display = gameState.gameMode === CONSTANTS.MODES.NORMAL ? 'block' : 'none';
            document.getElementById('hard-core-description').classList.toggle(CONSTANTS.CSS_CLASSES.HIDDEN, gameState.gameMode !== CONSTANTS.MODES.HARD_CORE);
        });
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const parentMain = tab.closest('main');
                if (!parentMain) return;
                parentMain.querySelectorAll('.tab').forEach(t => t.classList.remove(CONSTANTS.CSS_CLASSES.ACTIVE));
                parentMain.querySelectorAll('section').forEach(s => s.classList.remove(CONSTANTS.CSS_CLASSES.ACTIVE));
                tab.classList.add(CONSTANTS.CSS_CLASSES.ACTIVE);
                const targetSection = parentMain.querySelector(`#${tab.dataset.target}`);
                if (targetSection) targetSection.classList.add(CONSTANTS.CSS_CLASSES.ACTIVE);
            });
        });

        // Listen for real-time input on quiz answers
        quizContainers.forEach(main => main.addEventListener('input', handleInputChange));
        
        startGameBtn.addEventListener('click', startGame);
        resetBtn.addEventListener('click', () => resetGame(true));
        forceQuitBtn.addEventListener('click', () => { if(gameState.timerId) { gameState.total = 0; tick(); } });
        closeModalBtn.addEventListener('click', () => stageClearModal.classList.remove(CONSTANTS.CSS_CLASSES.ACTIVE));
        
        closeGuideBtn.addEventListener('click', () => {
            guideModal.classList.remove('active');
            startModal.classList.add('active');
        });

        closeProgressModalBtn.addEventListener('click', () => {
            progressModal.classList.remove('active');
            showAnswersBtn.classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
            resetBtn.classList.remove(CONSTANTS.CSS_CLASSES.HIDDEN);
        });

        decreaseTimeBtn.addEventListener('click', () => {
            playSound(clickAudio);
            if (gameState.duration > 60) {
                gameState.duration -= 60;
                updateTimeSettingDisplay();
            }
        });

        increaseTimeBtn.addEventListener('click', () => {
            playSound(clickAudio);
            if (gameState.duration < 1800) { // Max 30 mins
                gameState.duration += 60;
                updateTimeSettingDisplay();
            }
        });

        showAnswersBtn.addEventListener('click', () => {
            document.querySelectorAll(`#${gameState.selectedSubject}-quiz-main input[data-answer]`).forEach(input => {
                input.value = input.dataset.answer;
                input.disabled = true;
                if (input.classList.contains(CONSTANTS.CSS_CLASSES.CORRECT)) {
                } else {
                    input.classList.remove(CONSTANTS.CSS_CLASSES.INCORRECT, CONSTANTS.CSS_CLASSES.RETRYING);
                    input.classList.add(CONSTANTS.CSS_CLASSES.REVEALED);
                }
            });
            showAnswersBtn.disabled = true;
        });

        // --- INITIAL SETUP ---
        function initializeApp() {
            resetGame(false); // Reset state without showing any modal
            guideModal.classList.add('active'); // Always show guide on page load
        }

        initializeApp();
    });
  </script>
</body>
</html>
